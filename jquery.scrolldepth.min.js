(function($,window,document,undefined){"use strict";var defaults={minHeight:0,elements:[],percentage:true,userTiming:true,pixelDepth:true,nonInteraction:true,gaGlobal:false,gtmOverride:false,sendBaseline:true,eventNaming:{category:{scrollDepth:"Scroll Depth"},action:{percentage:"Percentage",elements:"Elements",pixelDepth:"Pixel Depth"},label:{baseline:"Baseline"}}};var $window=$(window),cache=[],lastPixelDepth=0,universalGA,classicGA,gaGlobal,standardEventHandler;$.scrollDepth=function(options){var startTime=+new Date;options=$.extend(true,{},defaults,options);if($(document).height()<options.minHeight){return}if(options.gaGlobal){universalGA=true;gaGlobal=options.gaGlobal}else if(typeof ga==="function"){universalGA=true;gaGlobal="ga"}else if(typeof __gaTracker==="function"){universalGA=true;gaGlobal="__gaTracker"}if(typeof _gaq!=="undefined"&&typeof _gaq.push==="function"){classicGA=true}if(typeof options.eventHandler==="function"){standardEventHandler=options.eventHandler}else if(typeof dataLayer!=="undefined"&&typeof dataLayer.push==="function"&&!options.gtmOverride){standardEventHandler=function(data){dataLayer.push(data)}}if(options.percentage){sendBaseline(options.eventNaming.action.percentage)}else if(options.elements){sendBaseline(options.eventNaming.action.elements)}function sendBaseline(action,label){if(options.sendBaseline===false)return;var scrollDepth=options.eventNaming.category.scrollDepth,baseline=options.eventNaming.label.baseline;if(standardEventHandler){standardEventHandler({event:"ScrollDistance",eventCategory:scrollDepth,eventAction:action,eventLabel:baseline,eventValue:1,eventNonInteraction:true})}else{if(universalGA){window[gaGlobal]("send","event",scrollDepth,action,baseline,1,{nonInteraction:true})}if(classicGA){_gaq.push(["_trackEvent",scrollDepth,action,baseline,1,true])}}}function sendEvent(action,label,scrollDistance,timing){var scrollDepth=options.eventNaming.category.scrollDepth,pixelDepth=options.eventNaming.action.pixelDepth;if(standardEventHandler){standardEventHandler({event:"ScrollDistance",eventCategory:scrollDepth,eventAction:action,eventLabel:label,eventValue:1,eventNonInteraction:options.nonInteraction});if(options.pixelDepth&&arguments.length>2&&scrollDistance>lastPixelDepth){lastPixelDepth=scrollDistance;standardEventHandler({event:"ScrollDistance",eventCategory:scrollDepth,eventAction:pixelDepth,eventLabel:rounded(scrollDistance),eventValue:1,eventNonInteraction:options.nonInteraction})}if(options.userTiming&&arguments.length>3){standardEventHandler({event:"ScrollTiming",eventCategory:scrollDepth,eventAction:action,eventLabel:label,eventTiming:timing})}}else{if(universalGA){window[gaGlobal]("send","event",scrollDepth,action,label,1,{nonInteraction:options.nonInteraction});if(options.pixelDepth&&arguments.length>2&&scrollDistance>lastPixelDepth){lastPixelDepth=scrollDistance;window[gaGlobal]("send","event",scrollDepth,pixelDepth,rounded(scrollDistance),1,{nonInteraction:options.nonInteraction})}if(options.userTiming&&arguments.length>3){window[gaGlobal]("send","timing",scrollDepth,action,timing,label)}}if(classicGA){_gaq.push(["_trackEvent",scrollDepth,action,label,1,options.nonInteraction]);if(options.pixelDepth&&arguments.length>2&&scrollDistance>lastPixelDepth){lastPixelDepth=scrollDistance;_gaq.push(["_trackEvent",scrollDepth,pixelDepth,rounded(scrollDistance),1,options.nonInteraction])}if(options.userTiming&&arguments.length>3){_gaq.push(["_trackTiming",scrollDepth,action,timing,label,100])}}}}function calculateMarks(docHeight){return{"25%":parseInt(docHeight*.25,10),"50%":parseInt(docHeight*.5,10),"75%":parseInt(docHeight*.75,10),"100%":docHeight-5}}function checkMarks(marks,scrollDistance,timing){var percentage=options.eventNaming.action.percentage;$.each(marks,function(key,val){if($.inArray(key,cache)===-1&&scrollDistance>=val){sendEvent(percentage,key,scrollDistance,timing);cache.push(key)}})}function checkElements(elements,scrollDistance,timing){var elementsAction=options.eventNaming.action.elements;$.each(elements,function(index,elem){if($.inArray(elem,cache)===-1&&$(elem).length){if(scrollDistance>=$(elem).offset().top){sendEvent(elementsAction,elem,scrollDistance,timing);cache.push(elem)}}})}function rounded(scrollDistance){return(Math.floor(scrollDistance/250)*250).toString()}function throttle(func,wait){var context,args,result;var timeout=null;var previous=0;var later=function(){previous=new Date;timeout=null;result=func.apply(context,args)};return function(){var now=new Date;if(!previous)previous=now;var remaining=wait-(now-previous);context=this;args=arguments;if(remaining<=0){clearTimeout(timeout);timeout=null;previous=now;result=func.apply(context,args)}else if(!timeout){timeout=setTimeout(later,remaining)}return result}}$window.on("scroll.scrollDepth",throttle(function(){var docHeight=$(document).height(),winHeight=window.innerHeight?window.innerHeight:$window.height(),scrollDistance=$window.scrollTop()+winHeight,marks=calculateMarks(docHeight),timing=+new Date-startTime;if(cache.length>=4+options.elements.length){$window.off("scroll.scrollDepth");return}if(options.elements){checkElements(options.elements,scrollDistance,timing)}if(options.percentage){checkMarks(marks,scrollDistance,timing)}},500))}})(jQuery,window,document);